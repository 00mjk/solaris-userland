# This patch is fix for the Bug-23188922
# It is developed By solaris PSIF team. We plan to have a common upstream repo
# and submit these changes to it, but do not yet have a target date of doing it.
diff -r 1dc0d37edf06 src/verbs.c
--- a/src/verbs.c	Mon Jun 27 14:10:53 2016 +0530
+++ b/src/verbs.c	Mon Jun 27 15:34:44 2016 +0530
@@ -550,6 +550,8 @@
         qp->remote_qp = attr->dest_qp_num;
     if (attr_mask & IBV_QP_AV)
         qp->remote_lid = attr->ah_attr.dlid;
+    if ((attr_mask & IBV_QP_STATE) && (attr->qp_state == IBV_QPS_RTR) && qp->sq.sw)
+        qp->tsl = qp->sq.sw->tsl;
     return 0;
 }
