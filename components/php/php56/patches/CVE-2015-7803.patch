# Source: upstream
# https://bugs.php.net/bug.php?id=69720
# http://git.php.net/?p=php-src.git;a=commit;h=d698f0ae51f67c9cce870b09c59df3d6ba959244
# Patch adapted: using only source change, not binary test case.

X-Git-Url: http://72.52.91.13:8000/?p=php-src.git;a=blobdiff_plain;f=ext%2Fphar%2Futil.c;h=69da7b9b89db376e46c1f4abfb107ea7ee155447;hp=2c41adf92a7eac5b20f6d33a9f6cccce5826e3bd;hb=d698f0ae51f67c9cce870b09c59df3d6ba959244;hpb=bb98ed600ab6787d9d367927d49439be9a83441e

diff --git a/ext/phar/util.c b/ext/phar/util.c
index 2c41adf..69da7b9 100644
--- a/ext/phar/util.c
+++ b/ext/phar/util.c
@@ -494,7 +494,11 @@ really_get_entry:
 	(*ret)->is_tar = entry->is_tar;
 	(*ret)->fp = phar_get_efp(entry, 1 TSRMLS_CC);
 	if (entry->link) {
-		(*ret)->zero = phar_get_fp_offset(phar_get_link_source(entry TSRMLS_CC) TSRMLS_CC);
+		phar_entry_info *link = phar_get_link_source(entry TSRMLS_CC);
+		if(!link) {
+			return FAILURE;
+		}
+		(*ret)->zero = phar_get_fp_offset(link TSRMLS_CC);
 	} else {
 		(*ret)->zero = phar_get_fp_offset(entry TSRMLS_CC);
 	}

