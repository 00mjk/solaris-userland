In-house patch to the heat-keystone-setup script installed in
/usr/demo/openstack/keystone in order to use the standard Solaris UNIX
commands rather than the GNU ones. It also includes a corrected fix for
Launchpad bug 1260556. This is a Solaris-specific patch and is not
suitable for the upstream.

--- heat-2014.2.2/bin/heat-keystone-setup.orig	2014-08-07 15:08:53.000000000 -0700
+++ heat-2014.2.2/bin/heat-keystone-setup	2014-09-20 21:44:41.866870651 -0700
@@ -2,12 +2,14 @@
 
 set +e
 
+PATH=/usr/bin
+
 KEYSTONE_CONF=${KEYSTONE_CONF:-/etc/keystone/keystone.conf}
 
 # Extract some info from Keystone's configuration file
 if [[ -r "$KEYSTONE_CONF" ]]; then
-    CONFIG_SERVICE_TOKEN=$(sed 's/[[:space:]]//g' $KEYSTONE_CONF | grep ^admin_token= | cut -d'=' -f2)
-    CONFIG_ADMIN_PORT=$(sed 's/[[:space:]]//g' $KEYSTONE_CONF | grep ^admin_port= | cut -d'=' -f2)
+    CONFIG_SERVICE_TOKEN=$(tr -d '[\t ]' < $KEYSTONE_CONF | grep ^admin_token= | cut -d'=' -f2)
+    CONFIG_ADMIN_PORT=$(tr -d '[\t ]' < $KEYSTONE_CONF | grep ^admin_port= | cut -d'=' -f2)
 fi
 
 SERVICE_TOKEN=${OS_SERVICE_TOKEN:-$CONFIG_SERVICE_TOKEN}
@@ -102,7 +104,7 @@ get_data() {
     shift 3
 
     output=$("$@" | \
-           awk -F'|' \
+           nawk -F'|' \
                "! /^\+/ && \$${match_column} ~ \"^ *${regex} *\$\" \
                 { print \$${output_column} }")
 
@@ -116,7 +118,7 @@ get_id () {
 get_column_num() {
     local name=$1
     shift
-    $@ | awk -F'|' "NR == 2 && /^|/ { for (i=2; i<NF; i++) if (\$i ~ \"^ *${name} *\$\") print (i - 1) }"
+    $@ | nawk -F'|' "NR == 2 && /^\|/ { for (i=2; i<NF; i++) if (\$i ~ \"^ *${name} *\$\") print (i - 1) }"
 }
 
 get_user() {
@@ -208,7 +210,7 @@ delete_endpoint() {
 
     local url=$(get_data 1 "${service_type}[.]publicURL" 2 \
                 get_endpoint $service_type 2>/dev/null | \
-                sed -r "s/[a-f0-9]{32}/$urlsuffix/")
+                sed "s/[a-f0-9]\{32\}/$urlsuffix/")
 
     if [ -n "$url" ]; then
         local endpoints=$(get_data 3 $url 1 keystone endpoint-list)
@@ -280,7 +282,7 @@ keystone_setup() {
     die_if_not_set $LINENO ADMIN_ROLE "Fail to get ADMIN_ROLE by 'keystone role-list' "
     SERVICE_TENANT=$(get_data 2 service 1 keystone tenant-list)
     die_if_not_set $LINENO SERVICE_TENANT "Fail to get service tenant 'keystone tenant-list' "
-    SERVICE_PASSWORD=${SERVICE_PASSWORD:-$OS_PASSWORD}
+    SERVICE_PASSWORD=${SERVICE_PASSWORD:-heat}
     SERVICE_HOST=${SERVICE_HOST:-localhost}
 
     if [[ "$SERVICE_PASSWORD" == "$OS_PASSWORD" ]]; then
