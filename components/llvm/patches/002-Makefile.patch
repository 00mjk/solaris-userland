# Solaris autoconf-based build.
# https://llvm.org/bugs/show_bug.cgi?id=24641
--- tools/llvm-shlib/Makefile	2014-07-31 23:16:03.000000000 -0700
+++ tools/llvm-shlib/Makefile	2015-06-07 11:01:59.791190596 -0700
@@ -71,7 +71,9 @@
 
 ifeq ($(HOST_OS),SunOS)
     # add -z allextract ahead of other libraries on Solaris
-    LLVMLibsOptions := -Wl,-z -Wl,allextract $(LLVMLibsOptions)
+    LLVMLibsOptions := -Wl,-z -Wl,rescan -Wl,-z -Wl,allextract $(LLVMLibsOptions)
+    LLVMLibsOptions += -Wl,-h -Wl,lib$(LIBRARYNAME)$(SHLIBEXT)
+    LLVMLibsOptions += -Wl,-z -Wl,defaultextract -Wl,-z -Wl,defs
 endif
 
 ifeq ($(HOST_OS), $(filter $(HOST_OS), Cygwin MingW))
