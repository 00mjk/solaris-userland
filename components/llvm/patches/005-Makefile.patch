# Solaris autoconf-based build.
# https://llvm.org/bugs/show_bug.cgi?id=24641
--- tools/clang/tools/libclang/Makefile	2014-10-29 11:55:09.000000000 -0700
+++ tools/clang/tools/libclang/Makefile	2015-06-10 15:18:27.471754914 -0700
@@ -33,10 +33,16 @@
 include $(CLANG_LEVEL)/Makefile
 
 # Add soname to the library.
-ifeq ($(HOST_OS), $(filter $(HOST_OS), Linux FreeBSD GNU GNU/kFreeBSD))
+ifeq ($(HOST_OS), $(filter $(HOST_OS), Linux FreeBSD GNU GNU/kFreeBSD SunOS))
         LLVMLibsOptions += -Wl,-soname,lib$(LIBRARYNAME)$(SHLIBEXT)
 endif
 
+# Extract everything necessary from Solaris *.a archives
+ifeq ($(HOST_OS), $(filter $(HOST_OS), SunOS))
+  SharedLinkOptions += -Wl,-z -Wl,rescan-now -Wl,-z -Wl,allextract
+  LLVMLibsOptions += -Wl,-z -Wl,defaultextract
+endif
+
 ifeq ($(ENABLE_CLANG_ARCMT),1)
   CXX.Flags += -DCLANG_ENABLE_ARCMT
 endif
