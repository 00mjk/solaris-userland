# 7029500 Mercurial doesn't work through https in snv_161

--- mercurial-2.8.2/mercurial/keepalive.py	Wed Jan  2 03:46:39 2014
+++ mercurial-2.8.2/mercurial/keepalive.py	Wed Jan  2 03:46:39 2014
@@ -247,6 +251,8 @@
             else:
                 # no (working) free connections were found.  Create a new one.
                 h = http_class(host)
+                if req._tunnel_host:
+                        h._set_tunnel(req._tunnel_host)
                 if DEBUG:
                     DEBUG.info("creating new connection to %s (%d)",
                                host, id(h))
